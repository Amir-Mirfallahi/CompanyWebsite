import{r as h,j as e,a as O,L as q,S as A}from"./app-CJeqt3gf.js";import{A as D,H}from"./HomeLayout-BOQLhrO9.js";import{P as U}from"./ProductCard-D3e-EvQF.js";function G({filterFields:b,appliedFilters:g={},onFilterChange:w}){const[m,x]=h.useState({}),[u,S]=h.useState(!1);h.useEffect(()=>{const s={};b.forEach(t=>{g&&typeof g=="object"&&g[t.id]!==void 0?s[t.id]=g[t.id]:t.type==="range"?s[t.id]=t.min:t.type==="checkbox"?s[t.id]=[]:t.type==="radio"?s[t.id]=t.options[0].value:t.type==="select"&&(s[t.id]="")}),x(s)},[b,g]);const y=(s,t)=>{const r={...m,[s]:t};x(r),w(r)},N=b.reduce((s,t)=>{const r=t.type==="range"?"range":"options";return s[r]||(s[r]=[]),s[r].push(t),s},{}),j=s=>{const t=m[s.id];switch(s.type){case"range":return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:s.label}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t!==void 0?t:s.min," ",s.unit]})]}),e.jsx("input",{type:"range",min:s.min,max:s.max,step:s.step,value:t!==void 0?t:s.min,onChange:r=>y(s.id,parseFloat(r.target.value)),className:"w-full accent-blue-900"}),e.jsxs("div",{className:"flex justify-between text-sm text-gray-600",children:[e.jsxs("span",{children:[s.min," ",s.unit]}),e.jsxs("span",{children:[s.max," ",s.unit]})]})]},s.id);case"checkbox":return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",children:s.label}),s.count&&e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-200 rounded-full",children:s.count})]}),e.jsx("div",{className:"space-y-2",children:s.options.map(r=>e.jsxs("label",{className:"flex items-center gap-2 p-1 transition-colors rounded cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"checkbox",checked:Array.isArray(t)&&t.includes(r.value),onChange:l=>{const c=Array.isArray(t)?t:[],p=l.target.checked?[...c,r.value]:c.filter(i=>i!==r.value);y(s.id,p)},className:"text-blue-900 rounded"}),e.jsx("span",{className:"text-gray-700",children:r.label})]},r.value))})]},s.id);case"select":return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",children:s.label}),s.count&&e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-200 rounded-full",children:s.count})]}),e.jsxs("select",{value:t||"",onChange:r=>y(s.id,r.target.value),className:"w-full p-2 border border-gray-300 rounded-lg focus:border-blue-900 focus:ring-1 focus:ring-blue-900",children:[e.jsx("option",{value:"",children:"همه"}),s.options.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]})]},s.id);case"radio":return e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium",children:s.label}),s.count&&e.jsx("span",{className:"px-2 py-1 text-xs bg-gray-200 rounded-full",children:s.count})]}),e.jsx("div",{className:"space-y-2",children:s.options.map(r=>e.jsxs("label",{className:"flex items-center gap-2 p-1 transition-colors rounded cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"radio",name:s.id,value:r.value,checked:t===r.value,onChange:l=>y(s.id,l.target.value),className:"text-blue-900"}),e.jsx("span",{className:"text-gray-700",children:r.label})]},r.value))})]},s.id);default:return null}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 lg:hidden",children:e.jsxs("button",{onClick:()=>S(!u),className:"flex items-center justify-center w-full gap-2 px-4 py-3 font-medium text-blue-900 bg-white shadow rounded-xl",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),u?"مخفی کردن فیلترها":"نمایش فیلترها"]})}),e.jsxs("div",{className:`bg-white p-6 rounded-xl shadow-lg ${u?"block":"hidden lg:block"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-bold text-blue-900",children:"فیلترها"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[b.length," فیلتر"]})]}),N.range&&N.range.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx("h4",{className:"pb-2 mb-4 font-semibold text-gray-800 border-b text-md",children:"مقادیر"}),N.range.map(s=>j(s))]}),N.options&&N.options.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"pb-2 mb-4 font-semibold text-gray-800 border-b text-md",children:"گزینه‌ها"}),N.options.map(s=>j(s))]}),e.jsxs("button",{onClick:()=>{const s={};b.forEach(t=>{t.type==="range"?s[t.id]=t.min:t.type==="checkbox"?s[t.id]=[]:t.type==="radio"?s[t.id]=t.options[0].value:t.type==="select"&&(s[t.id]="")}),x(s),w(s)},className:"flex items-center justify-center w-full gap-2 px-4 py-2 mt-8 text-blue-900 transition-colors border border-blue-900 rounded-full hover:bg-blue-50",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"پاک کردن فیلترها"]})]})]})}function I({categories:b,activeCategory:g,setActiveCategory:w}){const m=h.useRef(null),[x,u]=h.useState(!1),[S,y]=h.useState(!1),[N,j]=h.useState(!1),[s,t]=h.useState(!0);h.useEffect(()=>{const l=document.dir||document.documentElement.dir;t(l==="rtl"||window.getComputedStyle(document.body).direction==="rtl");const c=()=>{const i=m.current;if(i)if(s){const k=i.scrollWidth-i.clientWidth;y(i.scrollLeft<-10),u(Math.abs(i.scrollLeft)<k-10)}else u(i.scrollLeft>0),y(i.scrollLeft<i.scrollWidth-i.clientWidth-10)},p=m.current;if(p)return c(),p.addEventListener("scroll",c),window.addEventListener("resize",c),()=>{p.removeEventListener("scroll",c),window.removeEventListener("resize",c)}},[b,s]),h.useEffect(()=>{const l=m.current;if(!l)return;const c=l.querySelector(`button[data-category="${g}"]`);if(c){const p=l.getBoundingClientRect(),i=c.getBoundingClientRect();if(i.left<p.left||i.right>p.right){const k=c.offsetLeft-l.clientWidth/2+c.clientWidth/2;l.scrollTo({left:s?-k:Math.max(0,k),behavior:"smooth"})}}},[g,s]);const r=l=>{const c=m.current;if(!c||N)return;j(!0);const p=c.clientWidth*.6,k=(s?l==="left"?"right":"left":l)==="left"?c.scrollLeft-p:c.scrollLeft+p;c.scrollTo({left:k,behavior:"smooth"}),setTimeout(()=>j(!1),500)};return e.jsxs("div",{className:"relative p-4 mb-8 bg-white shadow-lg rounded-xl","data-aos":"fade-up",children:[S&&e.jsx("div",{className:`absolute top-0 bottom-0 ${s?"right-0":"left-0"} z-10 w-12 pointer-events-none`,style:{background:s?"linear-gradient(270deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)":"linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)"}}),S&&e.jsx("button",{onClick:()=>r("left"),className:`absolute z-20 flex items-center justify-center w-8 h-8 text-blue-900 transition-all duration-300 transform -translate-y-1/2 bg-white rounded-full shadow-md ${s?"right-2":"left-2"} top-1/2 hover:bg-blue-50 hover:scale-110 active:scale-95`,"aria-label":s?"Scroll right":"Scroll left",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:s?"M9 5l7 7-7 7":"M15 19l-7-7 7-7"})})}),e.jsxs("div",{dir:s?"rtl":"ltr",ref:m,className:"flex gap-3 px-1 py-1 overflow-x-auto hide-scrollbar scroll-smooth",children:[e.jsx("button",{"data-category":"all",onClick:()=>w("all"),className:`whitespace-nowrap px-4 py-2 rounded-full transition-all duration-300 ${g==="all"?"bg-blue-900 text-white shadow-md transform scale-105":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-sm"}`,children:"همه محصولات"}),b.map(l=>e.jsx("button",{"data-category":l.id,onClick:()=>w(l.id),className:`whitespace-nowrap px-4 py-2 rounded-full transition-all duration-300 ${g==l.id?"bg-blue-900 text-white shadow-md transform scale-105":"bg-gray-100 text-gray-700 hover:bg-gray-200 hover:shadow-sm"}`,children:l.name},l.id))]}),x&&e.jsx("button",{onClick:()=>r("right"),className:`absolute z-20 flex items-center justify-center w-8 h-8 text-blue-900 transition-all duration-300 transform -translate-y-1/2 bg-white rounded-full shadow-md ${s?"left-2":"right-2"} top-1/2 hover:bg-blue-50 hover:scale-110 active:scale-95`,"aria-label":s?"Scroll left":"Scroll right",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:s?"M15 19l-7-7 7-7":"M9 5l7 7-7 7"})})}),x&&e.jsx("div",{className:`absolute top-0 bottom-0 ${s?"left-0":"right-0"} z-10 w-12 pointer-events-none`,style:{background:s?"linear-gradient(90deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)":"linear-gradient(270deg, rgba(255,255,255,1) 0%, rgba(255,255,255,0) 100%)"}}),e.jsx("style",{jsx:"true",children:`
                .hide-scrollbar {
                    -ms-overflow-style: none;  /* IE and Edge */
                    scrollbar-width: none;  /* Firefox */
                }
                .hide-scrollbar::-webkit-scrollbar {
                    display: none;  /* Chrome, Safari, Opera */
                }
                .scroll-smooth {
                    scroll-behavior: smooth;
                }
            `})]})}function J({activeFilters:b=[],onRemove:g,onClearAll:w,shareUrl:m}){return!b||!Array.isArray(b)||b.length===0?null:e.jsx("div",{className:"p-3 my-4 bg-white shadow-sm rounded-xl",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"ml-2 text-sm font-medium text-gray-700",children:"فیلترهای فعال:"}),b.map((x,u)=>e.jsxs("div",{className:"flex items-center bg-blue-50 text-blue-800 px-3 py-1.5 rounded-full text-sm",children:[e.jsx("span",{children:x.label||"شناخته نشده"}),e.jsx("button",{onClick:()=>g(x.id,x.value),className:"ml-2 text-blue-700 transition-colors hover:text-blue-900","aria-label":"حذف فیلتر",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]},`${x.id||"شناخته نشده"}-${u}`)),e.jsx("button",{onClick:w,className:"mr-1 text-sm text-gray-600 underline transition-colors hover:text-blue-800",children:"پاک کردن همه"}),m&&e.jsx("div",{className:"ml-auto",children:e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(m),alert("لینک فیلتر در کلیپ‌بورد کپی شد.")},className:"flex items-center gap-1 text-sm text-gray-600 transition-colors hover:text-blue-800",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})}),"اشتراک‌گذاری فیلترها"]})})]})})}function Y({header:b,footer:g,categories:w,products:m,filterFields:x,activeCategory:u,currentPage:S,hasMoreProducts:y,totalProducts:N,appliedFilters:j}){const[s,t]=h.useState(Array.isArray(m)?m:[]),[r,l]=h.useState(!1),[c,p]=h.useState(S||1),[i,k]=h.useState(y||!1),C=h.useRef(null),$=j||{},R=Array.isArray(w)?w:[],M=()=>{if(!j||typeof j!="object"||!x)return[];const n=[];return Object.entries(j).forEach(([d,a])=>{var v;if(a==null||a===""||Array.isArray(a)&&a.length===0)return;const o=x.find(f=>f.id===d);if(o)if(Array.isArray(a))a.forEach(f=>{var E;const L=(E=o.options)==null?void 0:E.find(T=>T.value===f);n.push({id:d,label:`${o.label}: ${(L==null?void 0:L.label)||f}`,value:f})});else if(o.type==="select"||o.type==="radio"){const f=(v=o.options)==null?void 0:v.find(L=>L.value===a);n.push({id:d,label:`${o.label}: ${(f==null?void 0:f.label)||a}`,value:a})}else o.type==="range"?n.push({id:d,label:`${o.label}: ${a} ${o.unit||""}`,value:a}):n.push({id:d,label:`${o.label}: ${a}`,value:a})}),n};h.useEffect(()=>{D.init({duration:800,once:!0})},[]),h.useEffect(()=>{t(Array.isArray(m)?m:[]),p(S||1),k(y||!1)},[m,S,y]),h.useEffect(()=>{if(!C.current||!i||r)return;const n=new IntersectionObserver(d=>{d[0].isIntersecting&&i&&!r&&W()},{threshold:.1});return n.observe(C.current),()=>n.disconnect()},[i,r,c]);const W=async()=>{if(!(!i||r)){l(!0);try{const n=new URLSearchParams;n.append("page",c+1),u&&u!=="all"&&n.append("category",u);const d=await O.get(`/api/products/load-more?${n.toString()}`),a=d.data.products||[],o=d.data.hasMore||!1;t(v=>[...v,...a]),k(o),p(v=>v+1)}catch(n){console.error("Failed to load more products:",n)}finally{l(!1)}}},P=n=>{const d={};u&&u!=="all"&&(d.category=u),n&&typeof n=="object"&&Object.keys(n).forEach(a=>{const o=n[a];o!=null&&o!==""&&(d[a]=o)}),A.get("/products",d,{preserveState:!0,preserveScroll:!0,replace:!0})},B=n=>{A.get("/products",{category:n==="all"?void 0:n})},z=(n,d)=>{if(!n)return;const a={};j&&typeof j=="object"&&Object.entries(j).forEach(([o,v])=>{if(o!==n)a[o]=v;else if(Array.isArray(v)&&d!==void 0){const f=v.filter(L=>L!==d);f.length>0&&(a[o]=f)}else d!==void 0&&v!==d&&(a[o]=v)}),u&&u!=="all"&&(a.category=u),A.get("/products",a,{preserveState:!0,replace:!0})};return e.jsxs(H,{header:b||{},footer:g||{},className:"pt-32 bg-gray-50",children:[e.jsxs(q,{children:[e.jsx("title",{children:"محصولات"}),e.jsx("meta",{name:"description",content:"مشاهده و جستجوی محصولات"})]}),e.jsxs("div",{className:"container px-4 mx-auto",children:[e.jsxs("div",{className:"mb-8 text-center","data-aos":"fade-up",children:[e.jsx("h1",{className:"mb-4 text-4xl font-black text-blue-900",children:"محصولات"}),e.jsxs("div",{className:"text-sm text-gray-500",children:["نمایش ",s.length," محصول از ",N||0," محصول"]})]}),e.jsx(I,{categories:R,activeCategory:u||"all",setActiveCategory:B}),e.jsx(J,{activeFilters:M(),onRemove:z,onClearAll:()=>A.get("/products"),shareUrl:window.location.href}),e.jsxs("div",{className:"grid gap-8 py-8 lg:grid-cols-4",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(G,{filterFields:Array.isArray(x)?x:[],appliedFilters:$,onFilterChange:P})}),e.jsxs("div",{className:"lg:col-span-3",children:[s.length>0?e.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:s.map((n,d)=>e.jsx(U,{product:n||{},"data-aos":"fade-up"},d))}):e.jsxs("div",{className:"p-8 text-center bg-white shadow-lg rounded-xl",children:[e.jsx("h3",{className:"mb-2 text-xl font-bold text-gray-800",children:"هیچ محصولی یافت نشد"}),e.jsx("p",{className:"text-gray-600",children:"لطفا فیلترهای خود را تغییر دهید یا فیلترها را پاک کنید."}),e.jsx("button",{onClick:()=>A.get("/products"),className:"px-4 py-2 mt-4 text-white transition-colors bg-blue-900 rounded-full hover:bg-blue-800",children:"پاک کردن همه فیلترها"})]}),i&&e.jsx("div",{ref:C,className:"flex items-center justify-center p-8 mt-4",children:r&&e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("div",{className:"w-10 h-10 border-b-2 border-blue-900 rounded-full animate-spin"}),e.jsx("span",{className:"mr-3 text-blue-900",children:"در حال بارگذاری..."})]})}),!i&&s.length>0&&e.jsx("div",{className:"p-6 text-center text-gray-600",children:"تمام محصولات نمایش داده شده است."})]})]})]})]})}export{Y as default};
